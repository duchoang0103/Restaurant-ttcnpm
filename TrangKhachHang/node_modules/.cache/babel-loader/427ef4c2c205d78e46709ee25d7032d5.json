{"ast":null,"code":"import _classCallCheck from \"C:\\\\Users\\\\NguyenDucTuan\\\\Desktop\\\\07-frontend-updating-a-post\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"C:\\\\Users\\\\NguyenDucTuan\\\\Desktop\\\\07-frontend-updating-a-post\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"C:\\\\Users\\\\NguyenDucTuan\\\\Desktop\\\\07-frontend-updating-a-post\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"C:\\\\Users\\\\NguyenDucTuan\\\\Desktop\\\\07-frontend-updating-a-post\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"C:\\\\Users\\\\NguyenDucTuan\\\\Desktop\\\\07-frontend-updating-a-post\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nimport _assertThisInitialized from \"C:\\\\Users\\\\NguyenDucTuan\\\\Desktop\\\\07-frontend-updating-a-post\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/assertThisInitialized\";\nvar _jsxFileName = \"C:\\\\Users\\\\NguyenDucTuan\\\\Desktop\\\\07-frontend-updating-a-post\\\\src\\\\App.js\";\nimport React, { Component, Fragment } from 'react';\nimport { Route, Switch, Redirect, withRouter } from 'react-router-dom';\nimport ReactNotifications from 'react-notifications-component';\nimport LoginPage from './pages/Auth/Login';\nimport SignupPage from './pages/Auth/Signup';\nimport './App.css';\nimport Header from './components/TrangKhachHang/Header/Header';\nimport Footer from './components/TrangKhachHang/Footer/Footer';\nimport Main from './components/TrangKhachHang/Main/Main';\nimport Order from './components/TrangKhachHang/Order/Order';\nimport GioHang from './components/TrangKhachHang/GioHang/GioHang';\nimport Login from './pages/Auth/Login';\nimport { URLserver } from './components/TrangKhachHang/constant';\n\nvar App = /*#__PURE__*/function (_Component) {\n  _inherits(App, _Component);\n\n  function App() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, App);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(App)).call.apply(_getPrototypeOf2, [this].concat(args)));\n    _this.state = {\n      showBackdrop: false,\n      showMobileNav: false,\n      isAuth: false,\n      token: localStorage.getItem('token'),\n      userId: '',\n      authLoading: false,\n      error: null\n    };\n\n    _this.logoutHandler = function () {\n      _this.setState({\n        isAuth: false,\n        token: null\n      });\n\n      localStorage.removeItem('token');\n      localStorage.removeItem('expiryDate');\n      localStorage.removeItem('userId');\n    };\n\n    _this.loginHandler = function (event, authData) {\n      event.preventDefault();\n\n      _this.setState({\n        authLoading: true\n      });\n\n      var formData = new FormData();\n      formData.append('email', authData.email);\n      formData.append('password', authData.password);\n      var method = 'POST';\n      var url = URLserver + '/auth/login';\n      fetch(url, {\n        method: method,\n        headers: {\n          'Authorization': 'Bearer ' + _this.props.token\n        },\n        body: formData\n      }).then(function (res) {\n        if (res.status === 422) {\n          throw new Error('Validation failed.');\n        }\n\n        if (res.status !== 200 && res.status !== 201) {\n          console.log('Error!');\n          throw new Error('Could not authenticate you!');\n        }\n\n        return res.json();\n      }).then(function (resData) {\n        console.log(resData);\n\n        _this.setState({\n          isAuth: true,\n          token: resData.token,\n          authLoading: false,\n          userId: resData.userId\n        });\n\n        localStorage.setItem('token', resData.token);\n        localStorage.setItem('userId', resData.userId);\n        var remainingMilliseconds = 60 * 60 * 1000;\n        var expiryDate = new Date(new Date().getTime() + remainingMilliseconds);\n        localStorage.setItem('expiryDate', expiryDate.toISOString());\n\n        _this.setAutoLogout(remainingMilliseconds);\n      }).catch(function (err) {\n        console.log(err);\n\n        _this.setState({\n          isAuth: false,\n          authLoading: false,\n          error: err\n        });\n      });\n    };\n\n    _this.signupHandler = function (event, authData) {\n      event.preventDefault();\n\n      _this.setState({\n        authLoading: true\n      });\n\n      fetch('URL').then(function (res) {\n        if (res.status === 422) {\n          throw new Error(\"Validation failed. Make sure the email address isn't used yet!\");\n        }\n\n        if (res.status !== 200 && res.status !== 201) {\n          console.log('Error!');\n          throw new Error('Creating a user failed!');\n        }\n\n        return res.json();\n      }).then(function (resData) {\n        console.log(resData);\n\n        _this.setState({\n          isAuth: false,\n          authLoading: false\n        });\n\n        _this.props.history.replace('/');\n      }).catch(function (err) {\n        console.log(err);\n\n        _this.setState({\n          isAuth: false,\n          authLoading: false,\n          error: err\n        });\n      });\n    };\n\n    _this.setAutoLogout = function (milliseconds) {\n      setTimeout(function () {\n        _this.logoutHandler();\n      }, milliseconds);\n    };\n\n    _this.errorHandler = function () {\n      _this.setState({\n        error: null\n      });\n    };\n\n    _this.getDataLogin = function (token, userId) {\n      console.log('đã get đc data');\n      console.log(token);\n      console.log(userId);\n\n      _this.setState({\n        token: token,\n        userId: userId,\n        isAuth: true\n      });\n    };\n\n    _this.showRedirect = function () {\n      var isAuth = _this.state.isAuth;\n\n      if (isAuth) {\n        _this.setState({\n          isAuth: false\n        });\n\n        return /*#__PURE__*/React.createElement(Redirect, {\n          to: \"/\",\n          __self: _assertThisInitialized(_assertThisInitialized(_this)),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 163,\n            columnNumber: 14\n          }\n        });\n      }\n    };\n\n    return _this;\n  }\n\n  _createClass(App, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var token = localStorage.getItem('token');\n      var expiryDate = localStorage.getItem('expiryDate');\n\n      if (!token || !expiryDate) {\n        return;\n      }\n\n      if (new Date(expiryDate) <= new Date()) {\n        this.logoutHandler();\n        return;\n      }\n\n      var userId = localStorage.getItem('userId');\n      var remainingMilliseconds = new Date(expiryDate).getTime() - new Date().getTime();\n      this.setState({\n        isAuth: true,\n        token: token,\n        userId: userId\n      });\n      this.setAutoLogout(remainingMilliseconds);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var routes = /*#__PURE__*/React.createElement(Switch, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 168,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(Route, {\n        path: \"/\",\n        exact: true,\n        render: function render(props) {\n          return /*#__PURE__*/React.createElement(Fragment, {\n            __self: _this2,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 173,\n              columnNumber: 13\n            }\n          }, /*#__PURE__*/React.createElement(Login, {\n            getDataLogin: _this2.getDataLogin,\n            loginHandler: _this2.loginHandler,\n            __self: _this2,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 175,\n              columnNumber: 19\n            }\n          }));\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 169,\n          columnNumber: 9\n        }\n      }), /*#__PURE__*/React.createElement(Route, {\n        path: \"/signup\",\n        exact: true,\n        render: function render(props) {\n          return /*#__PURE__*/React.createElement(SignupPage, Object.assign({}, props, {\n            onSignup: _this2.signupHandler,\n            loading: _this2.state.authLoading,\n            __self: _this2,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 184,\n              columnNumber: 13\n            }\n          }));\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 180,\n          columnNumber: 9\n        }\n      }));\n\n      if (this.state.isAuth) {\n        routes = /*#__PURE__*/React.createElement(Switch, {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 197,\n            columnNumber: 9\n          }\n        }, /*#__PURE__*/React.createElement(Route, {\n          path: \"/\",\n          exact: true,\n          render: function render(props) {\n            return /*#__PURE__*/React.createElement(Fragment, {\n              __self: _this2,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 203,\n                columnNumber: 15\n              }\n            }, /*#__PURE__*/React.createElement(Header, {\n              __self: _this2,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 205,\n                columnNumber: 19\n              }\n            }), /*#__PURE__*/React.createElement(Main, {\n              userId: _this2.state.userId,\n              token: _this2.state.token,\n              __self: _this2,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 206,\n                columnNumber: 19\n              }\n            }), /*#__PURE__*/React.createElement(Footer, {\n              __self: _this2,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 207,\n                columnNumber: 19\n              }\n            }));\n          },\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 198,\n            columnNumber: 11\n          }\n        }), /*#__PURE__*/React.createElement(Route, {\n          path: \"/GioHang\",\n          exact: true,\n          render: function render(props) {\n            return /*#__PURE__*/React.createElement(Fragment, {\n              __self: _this2,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 216,\n                columnNumber: 15\n              }\n            }, /*#__PURE__*/React.createElement(Header, {\n              __self: _this2,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 218,\n                columnNumber: 19\n              }\n            }), /*#__PURE__*/React.createElement(GioHang, {\n              token: _this2.state.token,\n              __self: _this2,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 219,\n                columnNumber: 19\n              }\n            }), /*#__PURE__*/React.createElement(Footer, {\n              __self: _this2,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 220,\n                columnNumber: 19\n              }\n            }));\n          },\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 211,\n            columnNumber: 11\n          }\n        }), /*#__PURE__*/React.createElement(Route, {\n          path: \"/DonHang\",\n          exact: true,\n          render: function render(props) {\n            return /*#__PURE__*/React.createElement(Fragment, {\n              __self: _this2,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 229,\n                columnNumber: 15\n              }\n            }, /*#__PURE__*/React.createElement(Header, {\n              __self: _this2,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 231,\n                columnNumber: 19\n              }\n            }), /*#__PURE__*/React.createElement(Order, {\n              token: _this2.state.token,\n              __self: _this2,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 233,\n                columnNumber: 19\n              }\n            }), /*#__PURE__*/React.createElement(Footer, {\n              __self: _this2,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 234,\n                columnNumber: 19\n              }\n            }));\n          },\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 224,\n            columnNumber: 11\n          }\n        }));\n        console.log(\"routes\");\n        console.log(routes);\n      }\n\n      return /*#__PURE__*/React.createElement(Fragment, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 249,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(ReactNotifications, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 250,\n          columnNumber: 9\n        }\n      }), routes);\n    }\n  }]);\n\n  return App;\n}(Component);\n\nexport default withRouter(App);","map":{"version":3,"sources":["C:/Users/NguyenDucTuan/Desktop/07-frontend-updating-a-post/src/App.js"],"names":["React","Component","Fragment","Route","Switch","Redirect","withRouter","ReactNotifications","LoginPage","SignupPage","Header","Footer","Main","Order","GioHang","Login","URLserver","App","state","showBackdrop","showMobileNav","isAuth","token","localStorage","getItem","userId","authLoading","error","logoutHandler","setState","removeItem","loginHandler","event","authData","preventDefault","formData","FormData","append","email","password","method","url","fetch","headers","props","body","then","res","status","Error","console","log","json","resData","setItem","remainingMilliseconds","expiryDate","Date","getTime","toISOString","setAutoLogout","catch","err","signupHandler","history","replace","milliseconds","setTimeout","errorHandler","getDataLogin","showRedirect","routes"],"mappings":"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","sourcesContent":["import React, { Component, Fragment } from 'react';\nimport { Route, Switch, Redirect, withRouter } from 'react-router-dom';\nimport ReactNotifications from 'react-notifications-component';\n\nimport LoginPage from './pages/Auth/Login';\nimport SignupPage from './pages/Auth/Signup';\nimport './App.css';\nimport Header from './components/TrangKhachHang/Header/Header';\nimport Footer from './components/TrangKhachHang/Footer/Footer';\nimport Main from './components/TrangKhachHang/Main/Main';\nimport Order from './components/TrangKhachHang/Order/Order';\nimport GioHang from './components/TrangKhachHang/GioHang/GioHang';\nimport Login from './pages/Auth/Login';\nimport { URLserver } from './components/TrangKhachHang/constant';\n\nclass App extends Component {\n  state = {\n    showBackdrop: false,\n    showMobileNav: false,\n    isAuth: false,\n    token: localStorage.getItem('token'),\n    userId: '',\n    authLoading: false,\n    error: null\n  };\n\n  componentDidMount() {\n    const token = localStorage.getItem('token');\n    const expiryDate = localStorage.getItem('expiryDate');\n    if (!token || !expiryDate) {\n      return;\n    }\n    if (new Date(expiryDate) <= new Date()) {\n      this.logoutHandler();\n      return;\n    }\n    const userId = localStorage.getItem('userId');\n    const remainingMilliseconds =\n      new Date(expiryDate).getTime() - new Date().getTime();\n    this.setState({ isAuth: true, token: token, userId: userId });\n    this.setAutoLogout(remainingMilliseconds);\n  }\n\n  logoutHandler = () => {\n    this.setState({ isAuth: false, token: null });\n    localStorage.removeItem('token');\n    localStorage.removeItem('expiryDate');\n    localStorage.removeItem('userId');\n  };\n\n  loginHandler = (event, authData) => {\n    event.preventDefault();\n    this.setState({ authLoading: true });\n    const formData = new FormData();\n    formData.append('email', authData.email);\n    formData.append('password', authData.password);\n\n    let method = 'POST';\n    let url = URLserver + '/auth/login';\n\n    fetch(url, {\n      method: method,\n      headers: { 'Authorization': 'Bearer ' + this.props.token },\n      body: formData\n    })\n      .then(res => {\n        if (res.status === 422) {\n          throw new Error('Validation failed.');\n        }\n        if (res.status !== 200 && res.status !== 201) {\n          console.log('Error!');\n          throw new Error('Could not authenticate you!');\n        }\n        return res.json();\n      })\n      .then(resData => {\n        console.log(resData);\n        this.setState({\n          isAuth: true,\n          token: resData.token,\n          authLoading: false,\n          userId: resData.userId\n        });\n        localStorage.setItem('token', resData.token);\n        localStorage.setItem('userId', resData.userId);\n        const remainingMilliseconds = 60 * 60 * 1000;\n        const expiryDate = new Date(\n          new Date().getTime() + remainingMilliseconds\n        );\n        localStorage.setItem('expiryDate', expiryDate.toISOString());\n        this.setAutoLogout(remainingMilliseconds);\n        \n      })\n      .catch(err => {\n        console.log(err);\n        this.setState({\n          isAuth: false,\n          authLoading: false,\n          error: err\n        });\n      });\n  };\n\n  signupHandler = (event, authData) => {\n    event.preventDefault();\n    this.setState({ authLoading: true });\n    fetch('URL')\n      .then(res => {\n        if (res.status === 422) {\n          throw new Error(\n            \"Validation failed. Make sure the email address isn't used yet!\"\n          );\n        }\n        if (res.status !== 200 && res.status !== 201) {\n          console.log('Error!');\n          throw new Error('Creating a user failed!');\n        }\n        return res.json();\n      })\n      .then(resData => {\n        console.log(resData);\n        this.setState({ isAuth: false, authLoading: false });\n        this.props.history.replace('/');\n      })\n      .catch(err => {\n        console.log(err);\n        this.setState({\n          isAuth: false,\n          authLoading: false,\n          error: err\n        });\n      });\n  };\n\n  setAutoLogout = milliseconds => {\n    setTimeout(() => {\n      this.logoutHandler();\n    }, milliseconds);\n  };\n\n  errorHandler = () => {\n    this.setState({ error: null });\n  };\n  getDataLogin = (token, userId)=>{\n    console.log('đã get đc data');\n    console.log(token);\n    console.log(userId);\n    \n    \n    this.setState({\n      token: token,\n      userId: userId,\n      isAuth: true\n    })\n  }\n  showRedirect = () => {\n    const { isAuth } = this.state;\n\n    if (isAuth) {\n      this.setState({\n        isAuth: false\n      })\n      return <Redirect to='/' />;\n    }\n  }\n  render() {\n    let routes = (\n      <Switch>\n        <Route\n          path=\"/\"\n          exact\n          render={props => (\n            <Fragment>\n                  {/* <Header></Header> */}\n                  <Login getDataLogin={this.getDataLogin} loginHandler={this.loginHandler}></Login>\n                  {/* <Footer></Footer> */}\n              </Fragment>\n          )}\n        />\n        <Route\n          path=\"/signup\"\n          exact\n          render={props => (\n            <SignupPage\n              {...props}\n              onSignup={this.signupHandler}\n              loading={this.state.authLoading}\n            />\n          )}\n        />\n      </Switch>\n    );\n    if (this.state.isAuth) {\n      \n      \n      routes = (\n        <Switch>\n          <Route\n            path=\"/\"\n            exact\n            render={props => (\n              \n              <Fragment>\n                  \n                  <Header></Header>\n                  <Main userId={this.state.userId} token={this.state.token}></Main>\n                  <Footer></Footer>\n              </Fragment>\n            )}\n          />\n          <Route\n            path=\"/GioHang\"\n            exact\n            render={props => (\n              \n              <Fragment>\n                  \n                  <Header></Header>\n                  <GioHang token={this.state.token}></GioHang>\n                  <Footer></Footer>\n              </Fragment>\n            )}\n          />\n          <Route\n            path=\"/DonHang\"\n            exact\n            render={props => (\n              \n              <Fragment>\n                  \n                  <Header></Header>\n                  \n                  <Order token={this.state.token}></Order>\n                  <Footer></Footer>\n              </Fragment>\n            )}\n          />\n          \n        </Switch>\n\n      );\n      console.log(\"routes\");\n      console.log(routes);\n    }\n\n    \n    return (\n\n      <Fragment>\n        <ReactNotifications />\n        \n        {routes}\n      </Fragment>\n    );\n  }\n}\n\nexport default withRouter(App);\n"]},"metadata":{},"sourceType":"module"}